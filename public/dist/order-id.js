/*! opencloset - v0.0.1 - 2014-11-13 */$(function(){var a,b,c,d,e,f,g,h;return h=function(){var a;return a=$("#order").data("order-id"),$.ajax("/api/order/"+a+".json",{type:"GET",success:function(a){var b;return $("#order").data("order-clothes-price",a.clothes_price),$("#order").data("order-late-fee",a.late_fee),$("#order").data("order-late-fee-discount",0),$("#order").data("order-late-fee-final",a.late_fee),$("#order").data("order-late-fee-pay-with",a.late_fee_pay_with),$("#order").data("order-overdue",a.overdue),$("#order").data("order-parent-id",a.parent_id),$(".order-stage0-price").html(OpenCloset.commify(a.stage0_price)+"원"),$(".order-price").html(OpenCloset.commify(a.price)+"원"),b=_.template($("#tpl-late-fee").html()),$("#late-fee").html($(b(a))),b=_.template($("#tpl-late-fee-discount").html()),$("#late-fee-discount").html($(b(a))),$("#order-late-fee-discount").editable({display:function(a){return $(this).html(OpenCloset.commify(a))},success:function(b,c){var d,e;return d=parseInt(c),e=a.late_fee+d,$(".late-fee-final").html(OpenCloset.commify(e)+"원"),$("#order").data("order-late-fee-discount",d),$("#order").data("order-late-fee-final",e)}}),$(".late-fee-final").html(a.price===a.stage0_price?OpenCloset.commify(a.late_fee)+"원":OpenCloset.commify(a.price-a.stage0_price)+"원")},error:function(){},complete:function(){}})},h(),$("span.order-status.label").each(function(a,b){return $(b).addClass(OpenCloset.status[$(b).data("order-detail-status")].css)}),$("#order-staff-name").editable(),$("#order-additional-day").editable({source:function(){var a,b,c;for(c=[],a=b=0;20>=b;a=++b)c.push({value:a,text:""+(a+3)+"박 "+(a+4)+"일"});return c},success:function(b,c){return $(this).data("value",c),a()}}),$("#order-rental-date").editable({mode:"inline",showbuttons:"true",type:"combodate",emptytext:"비어있음",format:"YYYY-MM-DD",viewformat:"YYYY-MM-DD",template:"YYYY-MM-DD",combodate:{minYear:2013},url:function(a){var b,c;return c=$("#order").data("url"),b={},b[a.name]=a.value,$.ajax(c,{type:"PUT",data:b})},success:function(){return h()}}),$("#order-target-date").editable({mode:"inline",showbuttons:"true",type:"combodate",emptytext:"비어있음",format:"YYYY-MM-DD",viewformat:"YYYY-MM-DD",template:"YYYY-MM-DD",combodate:{minYear:2013},url:function(a){var b,c;return c=$("#order").data("url"),b={},b[a.name]=a.value+" 23:59:59",$.ajax(c,{type:"PUT",data:b})},success:function(){return h()}}),$("#order-user-target-date").editable({mode:"inline",showbuttons:"true",type:"combodate",emptytext:"비어있음",format:"YYYY-MM-DD",viewformat:"YYYY-MM-DD",template:"YYYY-MM-DD",combodate:{minYear:2013},url:function(a){var b,c;return c=$("#order").data("url"),b={},b[a.name]=a.value+" 23:59:59",$.ajax(c,{type:"PUT",data:b})}}),$("#order-price-pay-with").editable({source:function(){var a,b,c,d,e;for(d=OpenCloset.payWith,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push({value:a,text:a});return e}}),$("#order-late-fee-pay-with").editable({source:function(){var a,b,c,d,e;for(d=OpenCloset.payWith,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push({value:a,text:a});return e},success:function(a,b){return $("#order").data("order-late-fee-pay-with",b)}}),$(".order-detail").editable(),g=function(a){var b,c,d,e,f;return d=$("#order-detail-price-"+a).data("is-clothes"),e=$("#order-detail-price-"+a).data("is-pre-paid"),b=parseInt($("#order-additional-day").data("value")),f=parseInt($("#order-detail-price-"+a).data("value")),e?void 0:(c=d?f+.2*f*b:f*b,$("#order-detail-final-price-"+a).editable("setValue",c),$("#order-detail-final-price-"+a).editable("submit"))},$(".order-detail-price").each(function(a,b){return $(b).editable({display:function(a){return $(this).html(OpenCloset.commify(a))},success:function(a,c){return $(b).data("value",c),h(),g($(b).data("pk"))}})}),$("#order-desc").editable(),$(".order-detail-final-price").editable({display:function(a){return $(this).html(OpenCloset.commify(a))},success:function(){return h()}}),$("#btn-order-confirm").click(function(a){var b,c,d;return b=$("#order").data("order-id"),d=$(a.target).data("url"),c=$(a.target).data("redirect-url"),d&&b?$.ajax("/api/order/"+b+".json",{type:"GET",success:function(a){return a.staff_id?a.additional_day>=0?a.rental_date?a.target_date?a.price_pay_with?$.ajax(d,{type:"POST",data:{id:b,name:"status_id",value:2,pk:b},success:function(){return window.location.href=c},error:function(a){return OpenCloset.alert("danger",a.responseJSON.error)},complete:function(){}}):void OpenCloset.alert("danger","대여비 납부 여부를 확인하세요."):void OpenCloset.alert("danger","반납 예정일을 입력하세요."):void OpenCloset.alert("danger","대여일을 입력하세요."):void OpenCloset.alert("danger","대여 기간을 입력하세요."):void OpenCloset.alert("danger","담당자를 입력하세요.")},error:function(){},complete:function(){}}):void 0}),a=function(){var a,b,c,d;if(!$("#order-additional-day").data("disabled"))return a=parseInt($("#order-additional-day").data("value")),c=parseInt($("#order").data("order-parent-id")),c?(d=$("#order-rental-date").editable("getValue",!0),b=moment(d).add("days",a+3).endOf("day"),$("#order-target-date").editable("setValue",b.format("YYYY-MM-DD HH:mm:ss"),!0),$("#order-target-date").editable("submit"),$("#order-user-target-date").editable("setValue",b.format("YYYY-MM-DD HH:mm:ss"),!0),$("#order-user-target-date").editable("submit")):($("#order-rental-date").editable("setValue",moment().format("YYYY-MM-DD HH:mm:ss"),!0),$("#order-rental-date").editable("submit"),$("#order-target-date").editable("setValue",moment().add("days",a+3).endOf("day").format("YYYY-MM-DD HH:mm:ss"),!0),$("#order-target-date").editable("submit"),$("#order-user-target-date").editable("setValue",moment().add("days",a+3).endOf("day").format("YYYY-MM-DD HH:mm:ss"),!0),$("#order-user-target-date").editable("submit")),$("#order table td:nth-child(6) span").html("4+"+a+"일"),$(".order-detail-price").each(function(a,b){return g($(b).data("pk"))})},a(),$("#btn-return-process").click(function(){return $(".return-process input[data-clothes-code]").prop("checked",0),$(".return-process").show(),$(".return-process-reverse").hide(),$("#clothes-search").val("").focus(),$("#order-late-fee-pay-with").editable("enable")}),$("#btn-return-cancel").click(function(){return $(".return-process input[data-clothes-code]").prop("checked",0),$(".return-process").hide(),$(".return-process-reverse").show(),$("#order-late-fee-pay-with").editable("disable"),$("#order-late-fee-pay-with").editable("setValue",""),$("#order-late-fee-pay-with").html("미납")}),d=function(a,b,c,d){var e,f,g,h,i;return a?(g=[],$("input[data-clothes-code]").each(function(a,b){return $(b).prop("checked")?g.push($(b).data("id")):void 0}),i="/api/order/"+c+"/return-part.json",f={status_id:9,return_date:moment().format("YYYY-MM-DD HH:mm:ss"),return_method:"직접방문",late_fee_pay_with:d,order_detail_id:g}):(g=[],$("input[data-clothes-code]").each(function(a,b){return g.push($(b).data("id"))}),h=function(){var a,b,c;for(c=[],a=0,b=g.length;b>a;a++)e=g[a],c.push(9);return c}(),i="/api/order/"+c+".json",f={status_id:9,return_date:moment().format("YYYY-MM-DD HH:mm:ss"),return_method:"직접방문",late_fee_pay_with:d,order_detail_id:g,order_detail_status_id:h}),$.ajax(i,{type:"PUT",data:$.param(f,1),success:function(){return window.location.href=b}})},e=function(a,b){var c,e,f,g,h,i,j;return i=$("#order").data("order-id"),c=$("#order").data("order-clothes-price"),e=$("#order").data("order-late-fee"),f=$("#order").data("order-late-fee-discount"),g=$("#order").data("order-late-fee-final"),h=$("#order").data("order-late-fee-pay-with"),j=$("#order").data("order-overdue"),g>0&&!h?void OpenCloset.alert("danger","연체료를 납부받지 않았습니다."):$.ajax("/api/order_detail.json",{type:"POST",data:{order_id:i,name:"연체료",price:.2*c,final_price:e,stage:1,desc:""+OpenCloset.commify(c)+"원 x 20% x "+j+"일"},success:function(){return g>0&&h?$.ajax("/api/order_detail.json",{type:"POST",data:{order_id:i,name:"연체료 에누리",price:Math.round(f/j),final_price:f,stage:1},success:function(){return d(a,b,i,h)}}):d(a,b,i,h)}})},$("#btn-return-all").click(function(a){var c,d;return d=$(a.target).data("redirect-url"),c=b(),c.selected>0&&c.selected===c.total?e(0,d):void OpenCloset.alert("error","반납할 항목을 선택하지 않았습니다.")}),$("#btn-return-part").click(function(a){var c,d;return d=$(a.target).data("redirect-url"),c=b(),c.selected>0?e(1,d):void OpenCloset.alert("error","반납할 항목을 선택하지 않았습니다.")}),b=function(){var a,b;return a=0,b=0,$(".return-process input[data-clothes-code]").each(function(c,d){return $(d).prop("checked")&&++a,++b}),{selected:a,total:b}},c=function(){var a;return a=b(),a.selected>0?a.selected===a.total?($("#btn-return-all").removeClass("disabled"),$("#btn-return-part").addClass("disabled")):($("#btn-return-all").addClass("disabled"),$("#btn-return-part").removeClass("disabled")):($("#btn-return-all").addClass("disabled"),$("#btn-return-part").addClass("disabled"))},$(".return-process input[data-clothes-code]").click(function(){return c()}),f=function(){var a;return a=OpenCloset.trimClothesCode($("#clothes-search").val()),$("#clothes-search").val("").focus(),$(".return-process input[data-clothes-code="+a+"]").click(),c()},$("#clothes-search").keypress(function(a){return 13===a.keyCode?$("#btn-clothes-search").click():void 0}),$("#btn-clothes-search").click(function(){return f()})});