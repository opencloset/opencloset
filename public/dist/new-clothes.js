/*! opencloset - v0.0.1 - 2014-11-13 */$(function(){var a,b,c,d,e,f,g,h,i;return g=void 0,e=void 0,a=function(){var a;return(a=$("#user-search").val())?($("input[name=user-donation-id]").parent().removeClass("highlight"),$.ajax("/api/search/user.json",{type:"GET",data:{q:a},success:function(a){var b;return b=_.template($("#tpl-user-id").html()),_.each(a,function(a){var c;return $("#user-search-list input[data-user-id='"+a.id+"']").length?void 0:(c=$(b(a)),c.find("input").attr("data-json",JSON.stringify(a)),$("#user-search-list").prepend(c))}),a[0]?$("input[name=user-donation-id][data-type=user][value="+a[0].id+"]").click():void 0},error:function(a){var b,c;return b=null!=(c=404===a.status)?c:{warning:"danger"},OpenCloset.alert(b,a.responseJSON.error.str)},complete:function(){}}),$.ajax("/api/search/donation.json",{type:"GET",data:{q:a},success:function(a){var b;return b=_.template($("#tpl-donation-id").html()),_.each(a,function(a){var c;return $("#user-search-list input[data-donation-id='"+a.id+"']").length?void 0:(c=$(b(a)),c.find("input").attr("data-json",JSON.stringify(a)),$("#user-search-list").prepend(c))})},error:function(a){var b,c;return b=null!=(c=404===a.status)?c:{warning:"danger"},OpenCloset.alert(b,a.responseJSON.error.str)},complete:function(){}})):void 0},$("#user-search-list").on("click",":radio",function(){var a,b;return g=$(this).data("user-id"),e=$(this).data("donation-id"),"0"!==$(this).val()?(e?(a=$(this).data("json"),b=a.user,$("#donation-message").val(a.message),$("#donation-message").prop("disabled",!0)):(b=$(this).data("json"),$("#donation-message").prop("disabled",!1)),_.each(["name","email","phone","address","gender","birth"],function(a){var c;return c=$("input[name="+a+"]"),"radio"===c.attr("type")||"checkbox"===c.attr("type")?c.each(function(c,d){return $(d).val()===b[a]?$(d).attr("checked",!0):void 0}):c.val(b[a])})):void 0}),$("#user-search").keypress(function(b){return 13===b.keyCode?a():void 0}),$("#btn-user-search").click(function(){return a()}),a(),b=function(a){return a?_.each(["bust","waist","hip","belly","thigh","arm","length","foot"],function(a){return $("#display-clothes-"+a).show()}):_.each(["bust","waist","hip","belly","thigh","arm","length","foot"],function(a){return $("#display-clothes-"+a).hide()}),$("#clothes-code").val(""),$("input[name=clothes-gender]").prop("checked",!1),$("#clothes-color").select2("val",""),_.each(["bust","waist","hip","belly","thigh","arm","length","foot"],function(a){return $("#clothes-"+a).prop("disabled",!0).val("")})},$("#clothes-category").select2({dropdownCssClass:"bigdrop",data:function(){var a,b;a=OpenCloset.category,b=[];for(f in a)h=a[f],b.push({id:f,text:h.str});return b}()}).on("change",function(a){var c,d,e,f,g;switch(b(!1),d=[],a.val){case"jacket":d=["bust","arm","belly"];break;case"pants":d=["waist","hip","thigh","length"];break;case"shirt":d=["bust","arm","belly"];break;case"waistcoat":d=["waist","belly"];break;case"coat":d=["bust","arm","length"];break;case"onepiece":d=["bust","waist","hip","arm","length"];break;case"skirt":d=["waist","hip","length"];break;case"blouse":d=["bust","arm"];break;case"belt":d=["length"];break;case"shoes":d=["foot"];break;default:d=[]}for(g=[],e=0,f=d.length;f>e;e++)c=d[e],$("#display-clothes-"+c).show(),g.push($("#clothes-"+c).prop("disabled",!1));return g}),$("#clothes-color").select2({dropdownCssClass:"bigdrop",data:function(){var a,b;a=OpenCloset.color,b=[];for(c in a)d=a[c],b.push({id:c,text:d});return b}()}),$("#clothes-category").select2("val",""),b(!0),$("#btn-clothes-reset").click(function(){return $("#clothes-category").select2("val",""),b(!0)}),$("#btn-clothes-add").click(function(){var a,b,c;return b={user_id:g,clothes_code:$("#clothes-code").val(),clothes_category:$("#clothes-category").val(),clothes_category_str:$("#clothes-category option:selected").text(),clothes_gender:$("input[name=clothes-gender]:checked").val(),clothes_gender_str:$("input[name=clothes-gender]:checked").next().text(),clothes_color:$("#clothes-color").val(),clothes_color_str:$("#clothes-color option:selected").text(),clothes_bust:$("#clothes-bust").val(),clothes_waist:$("#clothes-waist").val(),clothes_hip:$("#clothes-hip").val(),clothes_belly:$("#clothes-belly").val(),clothes_thigh:$("#clothes-thigh").val(),clothes_arm:$("#clothes-arm").val(),clothes_length:$("#clothes-length").val(),clothes_foot:$("#clothes-foot").val()},b.clothes_category?(a=0,c=0,$("#clothes-color").val()?(a++,c++):a++,$("#step3 input:enabled").each(function(b,d){if(/^clothes-/.test($(d).attr("id")))switch(a++,$(d).attr("id")){case"clothes-code":if(/^[a-z0-9]{4,5}$/i.test($(d).val()))return c++;break;case"clothes-color":if($(d).val())return c++;break;case"clothes-category":if($(d).val())return c++;break;default:if($(d).val()>0)return c++}}),a!==c?void OpenCloset.alert("warning","빠진 항목이 있습니다."):$.ajax("/api/clothes/"+b.clothes_code+".json",{type:"GET",dataType:"json",success:function(){return OpenCloset.alert("warning","이미 존재하는 의류 코드입니다.")},error:function(a){var c,d;return 404!==a.status?void OpenCloset.alert("warning","의류 코드 오류입니다."):(c=_.template($("#tpl-clothes-item").html()),d=$(c(b)),$("#display-clothes-list").append(d),$("#btn-clothes-reset").click(),$("#clothes-category").focus())},complete:function(){}})):void 0}),$("#btn-clothes-select-all").click(function(){var a,b,c;return b=0,a=0,$("input[name=clothes-list]").each(function(c,d){return b++,$(d).prop("checked")?a++:void 0}),$("input[name=clothes-list]").prop("checked",null!=(c=b>a)?c:{"true":!1})}),i=!1,$("#fuelux-wizard").ace_wizard().on("change",function(a,b){var c,d;if(1===b.step&&i&&!$("#validation-form").valid())return!1;if("next"!==b.direction)return!0;switch(c={},b.step){case 2:return g?(c.type="PUT",c.path="/api/user/"+g+".json"):(c.type="POST",c.path="/api/user.json"),$.ajax(c.path,{type:c.type,data:$("form").serialize(),success:function(a){return g=a.id,!0},error:function(a){return OpenCloset.alert("danger",a.responseJSON.error),!1},complete:function(){}});case 3:if(!$("input[name=clothes-list]:checked").length)return;return d=function(a){return $.ajax("/api/group.json",{type:"POST",success:function(b){return $("input[name=clothes-list]:checked").each(function(c,d){return $.ajax("/api/clothes.json",{type:"POST",data:{donation_id:a,group_id:b.id,code:$(d).data("clothes-code"),category:$(d).data("clothes-category"),gender:$(d).data("clothes-gender"),color:$(d).data("clothes-color"),bust:$(d).data("clothes-bust"),waist:$(d).data("clothes-waist"),hip:$(d).data("clothes-hip"),belly:$(d).data("clothes-belly"),thigh:$(d).data("clothes-thigh"),arm:$(d).data("clothes-arm"),length:$(d).data("clothes-length"),foot:$(d).data("clothes-foot"),price:OpenCloset.category[$(d).data("clothes-category")].price},success:function(){},error:function(a){return OpenCloset.alert("warning",a.responseJSON.error.str)},complete:function(){}})})},error:function(a){return OpenCloset.alert("warning",a.responseJSON.error.str)},complete:function(){}})},e?d(e):$.ajax("/api/donation.json",{type:"POST",data:{user_id:g,message:$("#donation-message").val()},success:function(a){return d(a.id)},error:function(a){return OpenCloset.alert("warning",a.responseJSON.error.str)},complete:function(){}})}}).on("finished",function(){return location.href="/",!1}).on("stepclick",function(){})});