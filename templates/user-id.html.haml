- use utf8;
- my $_id   = 'user-id';
- layout 'default',
-   page_id     => $_id,
-   active_id   => 'user',
-   breadcrumbs => [
-     { text => meta_text('user'), link => url_for( meta_link('user') ) },
-     { text => meta_text($_id)   },
-   ],
-   jses  => [ 
-     '/theme/ace/js/x-editable/bootstrap-editable.min.js',
-     '/theme/ace/js/x-editable/ace-editable.min.js',
-     '//cdn.poesis.kr/post/search.min.js',
-     '/assets/components/facebox/src/facebox.js',
-   ],
-   csses => [ 
-     '/assets/components/x-editable/dist/bootstrap3-editable/css/bootstrap-editable.css',
-     '//cdn.poesis.kr/post/search.css',
-     '/assets/components/facebox/src/facebox.css',
-   ],
-   ;
- title meta_text($_id) . q{: } . $user->name . q{님};

                %div
                  #user-profile-1.user-profile.row
                    /
                    / left
                    /
                    .col-xs-12.col-sm-3.center
                      %div
                        %span.profile-picture
                          %img.avatar.img-responsive{ :src => '#{ get_gravatar( $user, 180, https => 1 ) }' }
                        .space-4
                        .width-80.label.label-info.label-xlg.arrowed-in.arrowed-in-right
                          .inline.position-relative
                            %span.white.user-name= $user->name

                      .space-6

                      .profile-contact-info
                        .profile-contact-links.align-left
                          %a.btn.btn-link{ :href => "#{ url_for('/sms')->query( to => $user->user_info->phone ) }" }
                            %i.icon-phone.bigger-120.green
                            SMS 보내기
                          %a.btn.btn-link{ :href => 'mailto:#{ $user->email }' }
                            %i.icon-envelope.bigger-120.green
                            메일 보내기

                      .hr.hr12.dotted

                      .clearfix
                        .grid2
                          %span.bigger-175.blue= $donated_clothes_count
                          %br
                          기증한 옷
                        .grid2
                          %span.bigger-175.blue= $rented_clothes_count
                          %br
                          빌렸던 옷
                      .hr.hr16.dotted

                    /
                    / right
                    /
                    .col-xs-12.col-sm-9
                      .widget-box.transparent
                        /
                        / header
                        /
                        .widget-header.widget-header-small
                          %h4.blue.smaller
                            %i.icon-user.orange
                            사용자 정보
                        /
                        / body
                        /
                        .widget-body
                          .widget-main.padding-8
                            .profile-user-info.profile-user-info-striped
                              #profile-user-info-data{ 'data-pk' => "#{ $user->id }", 'data-url' => "#{ url_for( '/api/user/'. $user->id . '.json' ) }" }
                              .profile-info-row
                                .profile-info-name 이름
                                .profile-info-value
                                  %span.editable#user-name{ 'data-name' => 'name' }= $user->name

                              .profile-info-row
                                .profile-info-name 분류
                                .profile-info-value
                                  %span.editable#user-staff{ 'data-name' => 'staff', 'data-type' => 'select', 'data-value' => "#{ $user->user_info->staff }" }

                              .profile-info-row
                                .profile-info-name 전자우편
                                .profile-info-value
                                  %span.editable#user-email{ 'data-name' => 'email' }= $user->email

                              .profile-info-row
                                .profile-info-name 휴대전화
                                .profile-info-value
                                  %span.editable#user-phone{ 'data-name' => 'phone' }= $user->user_info->phone

                              - if ( $user->id == current_user->id ) {
                                .profile-info-row
                                  .profile-info-name 비밀번호
                                  .profile-info-value
                                    %span.editable#user-password{ 'data-name' => 'password' }
                              - }

                              .profile-info-row
                                .profile-info-name 주소
                                .profile-info-value
                                  %i.icon-map-marker.light-orange.bigger-110
                                  %span.editable#user-address{ 'data-name' => 'address' }= $user->user_info->address2
                                %input.postcodify_dbid{:name => 'address1' :type => 'hidden', :value => "#{$user->user_info->address1}"}
                                %input.postcodify_address{:name => 'address2' :type => 'hidden', :value => "#{$user->user_info->address2}"}
                                %input.postcodify_jibeonaddress{:name => 'address3' :type => 'hidden', :value => "#{$user->user_info->address3}"}

                              .profile-info-row
                                .profile-info-name 상세주소
                                .profile-info-value
                                  %i.icon-map-marker.light-orange.bigger-110
                                  %span.editable#user-detail-address{ 'data-name' => 'address4' }= $user->user_info->address4

                              .profile-info-row
                                .profile-info-name 성별
                                .profile-info-value
                                  %span.editable#user-gender{ 'data-name' => 'gender', 'data-type' => 'select', 'data-value' => "#{ $user->user_info->gender }" }

                              .profile-info-row
                                .profile-info-name 태어난 해
                                .profile-info-value
                                  %span.editable#user-birth{ 'data-name' => 'birth' }= $user->user_info->birth

                              .profile-info-row
                                .profile-info-name 설명
                                .profile-info-value
                                  %span.editable#user-comment{ 'data-name' => 'comment' }= $user->user_info->comment

                              .profile-info-row
                                .profile-info-name 대여 희망 품목
                                .profile-info-value
                                  %span.editable#user-pre_category{ 'data-name' => 'pre_category', 'data-value' => "#{ $user->user_info->pre_category}" }

                              .profile-info-row
                                .profile-info-name 대여 희망 색상
                                .profile-info-value
                                  %span.editable#user-pre_color{ 'data-name' => 'pre_color', 'data-value' => "#{ $user->user_info->pre_color }" }

                              .profile-info-row
                                .profile-info-name 키
                                .profile-info-value
                                  %span.editable#user-height{ 'data-name' => 'height' }= $user->user_info->height

                              .profile-info-row
                                .profile-info-name 몸무게
                                .profile-info-value
                                  %span.editable#user-weight{ 'data-name' => 'weight' }= $user->user_info->weight

                              .profile-info-row
                                .profile-info-name 가슴 둘레
                                .profile-info-value
                                  %span.editable#user-bust{ 'data-name' => 'bust' }= $user->user_info->bust

                              .profile-info-row
                                .profile-info-name 허리 둘레
                                .profile-info-value
                                  %span.editable#user-waist{ 'data-name' => 'waist' }= $user->user_info->waist

                              .profile-info-row
                                .profile-info-name 엉덩이 둘레
                                .profile-info-value
                                  %span.editable#user-hip{ 'data-name' => 'hip' }= $user->user_info->hip

                              .profile-info-row
                                .profile-info-name 배 둘레
                                .profile-info-value
                                  %span.editable#user-belly{ 'data-name' => 'belly' }= $user->user_info->belly

                              .profile-info-row
                                .profile-info-name 허벅지 둘레
                                .profile-info-value
                                  %span.editable#user-thigh{ 'data-name' => 'thigh' }= $user->user_info->thigh

                              .profile-info-row
                                .profile-info-name 팔 길이
                                .profile-info-value
                                  %span.editable#user-arm{ 'data-name' => 'arm' }= $user->user_info->arm

                              .profile-info-row
                                .profile-info-name 다리 길이
                                .profile-info-value
                                  %span.editable#user-leg{ 'data-name' => 'leg' }= $user->user_info->leg

                              .profile-info-row
                                .profile-info-name 무릎 길이
                                .profile-info-value
                                  %span.editable#user-knee{ 'data-name' => 'knee' }= $user->user_info->knee

                              .profile-info-row
                                .profile-info-name 발 크기
                                .profile-info-value
                                  %span.editable#user-foot{ 'data-name' => 'foot' }= $user->user_info->foot

                      .space-20

                      .widget-box.transparent
                        /
                        / header
                        /
                        .widget-header.widget-header-small
                          %h4.blue.smaller
                            %i.icon-rss.orange
                            최근 주문 내역
                        /
                        / body
                        /
                        .widget-body
                          .widget-main.padding-8
                            #profile-feed-1.profile-feed
                              - for my $order ( $user->orders ) {
                              -   next unless $order->status;
                              -   my $late_fee = calc_late_fee($order);
                                .profile-activity.clearfix
                                  %div
                                    %img.pull-left{ :alt => "#{ $user->name }'s avatar", :src => '#{ get_gravatar( $user, 36, https => 1 ) }' }
                                    = $user->name
                                    %a.order-badge{ :href => "/order/#{ $order->id }" }
                                      - if ( $order->rental_date && $order->target_date ) {
                                        %span.label.label-info.arrowed-right.arrowed-in
                                          %strong 주문서
                                          %time.js-relative-date{ :datetime => "#{ $order->rental_date }", :title => "#{ $order->rental_date->ymd }" }= $order->rental_date->month . '/' . $order->rental_date->day
                                          ~
                                          %time.js-relative-date{ :datetime => "#{ $order->target_date }", :title => "#{ $order->target_date->ymd }" }= $order->target_date->month . '/' . $order->target_date->day
                                      - }
                                      %span.label.order-status{ 'data-status' => "#{ $order->status->name }", 'data-late-fee' => "#{ $late_fee }" }
                                        %span.order-status-str= $order->status->name
                                        %span.late-fee= $late_fee ? commify($late_fee) . q{원} : q{}
                                    .time
                                      %i.icon-time.bigger-110
                                      = $order->create_date->ymd . q{ } . $order->create_date->hms
                              - }
